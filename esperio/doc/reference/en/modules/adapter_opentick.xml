<chapter id="adapter_opentick">
    <title>The Opentick Input Adapter</title>
    
    <sect1 id="adapter-opentick-intro">
        <title>Overview</title>

		<para>
			This section describes the use of the Opentick input adapter. Opentick is an API and a service of opentick corporation to receive real-time stock market data, see <literal>http://www.opentick.com</literal>.
		</para>
    
		<para>
			The Opentick input adapter is configured through a XML configuration file or directly through the <literal>ConfigurationOpentick</literal> class. The distribution provides a sample configuration file <literal>esperio-opentickadapter-config-sample.xml</literal> in the EsperIO <literal>etc</literal> folder.
		</para>
			
		<para>
			There are two path available to start adapter operation: The first option is to register the adapter's plug-in loader and thus automatically load and start the adapter at time of Esper engine initialization. The second option requires your application to instantiate an <literal>OpentickInputAdapter</literal>.
		</para>

		<sect4 id="adapter-opentick-loader">
			<title>Adapter Start via Plug-in Loader</title>
		
			<para>
				This method loads the adapter automatically at time of engine initialization.
			</para>

			<para>
				First, register the <literal>OpentickPluginLoader</literal> as one of the a plug-in loaders via the <literal>addPluginLoader</literal> method on the <literal>Configuration</literal> class or within the Esper configuration XML. For example:
			</para>
			<programlisting><![CDATA[Configuration config = new Configuration();
Properties pluginProperties = new Properties();
pluginProperties.put("classpath-app-context","esperio-opentickadapter-config-sample.xml");
config.addPluginLoader("OpentickPluginLoader", 
    OpentickPluginLoader.class.getName(), pluginProperties);
EPServiceProvider engine = EPServiceProviderManager.getDefaultProvider(config);]]></programlisting>

			<para>
				At the time of engine initialization the loader class retrieves the XML configuration file from classpath and instantiates and starts the <literal>OpentickInputAdapter</literal>.
			</para>
		</sect4>

		<sect4 id="adapter-opentick-adapter">
			<title>Adapter Start via Instantiation</title>
				<para>
					Your application may choose to use the <literal>OpentickInputAdapter</literal> class directly to start, stop, pause, resume and destroy the adapter separately from an Esper engine instance, or to configure via API and change the configuration at runtime.
				</para>

				<para>
					This code snippet shows how to load a configuration file from a file location in the classpath and then starts the adapter:
				</para>
				<programlisting><![CDATA[ConfigurationOpentick configOT = new ConfigurationOpentick();
URL url = Thread.currentThread().
    getContextClassLoader().getResource("esperio-opentickadapter-config-sample.xml");
if (url == null) {
  throw new RuntimException("File not found");
}
configOT.configure(url);

OpentickInputAdapter adapter = new OpentickInputAdapter(configOT);
adapter.start();]]></programlisting>
		</sect4>
    </sect1>
    
    <sect1 id="adapter-opentick-config">
        <title>Configuration</title>
        <para>
			The opentick adapter XML and API configuration provides the connection information and the streams subscribed to in OT and defines symbol lists as well as associates symbol lists to streams. Please review the sample configuration file
			in the <literal>etc</literal> folder of the EsperIO distribution.
        </para>

        <para>
			As part of the <literal>stream</literal> configuration your application may list the following stream names: OTQuote, OTMMQuote, OTTrade, OTBBO. 
			The <literal>type-name</literal> attribute assigns an name to the opentick event types available in EPL statements. 
			The event representation are the respective opentick API POJO objects: <literal>com.opentick.OTTrade</literal> and <literal>OTMMQuote</literal>, <literal>OTTrade</literal>, <literal>OTBBO</literal>.
        </para>
        
        <para>
			The <literal>symbollists</literal> element serves to define named lists of exchange and symbol combinations. The <literal>stream-symbollist</literal> element associates symbols to streams requested through the opentick API.
        </para>
    </sect1>

    <sect1 id="adapter-opentick-operation">
        <title>Operation</title>
        <para>
			The opentick adapter, once running, may be configured at runtime as well. To change symbol lists or request new streams at runtime, your application may obtain the <literal>ConfigurationOpentick</literal> from 
			the adapter, make changes, and restart the adapter via its <literal>pause, resume, start, stop and destroy</literal> operations. 
        </para>

        <para>
			Use the <literal>pause</literal> or <literal>stop</literal> operation and the <literal>resume</literal> operation to retain the existing connection, drop streams and request new streams based on the new configuration.
			Use the <literal>destroy</literal> and <literal>start</literal> operations to disconnect and reconnect.
        </para>
    </sect1>
</chapter>



